<section class="container admin-shell">
    <header class="admin-hero">
      <div>
        <p class="eyebrow">Store Console</p>
        <h2 style="margin:6px 0 4px">Admin</h2>
      </div>
      <div class="admin-badge">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‚úÖ</div>
    </header>

    <div class="admin-grid">
      <div class="panel admin-card">
        <div class="panel-header">
          <div>
            <p class="eyebrow">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</p>
            <h3 style="margin:4px 0">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô</h3>
          </div>
          <div class="pill pill-ghost">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà {{ ps.categories().length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
        </div>
        <div class="category-add-row">
          <input class="input" [(ngModel)]="catInput" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏∏‡πâ‡∏á / ‡∏õ‡∏•‡∏≤">
          <button class="btn primary" type="button" (click)="addCategory()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </div>
        <div class="category-list" *ngIf="ps.categories().length; else noCategories">
          <div class="category-row" *ngFor="let cat of ps.categories(); trackBy: trackCat">
            <input class="input" [ngModel]="catEdit[cat] ?? cat" (ngModelChange)="editCategory(cat, $event)">
            <div class="category-row__actions">
              <button class="btn" type="button" (click)="saveCategory(cat)">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
              <button class="btn danger ghost" type="button" (click)="removeCategory(cat)">‡∏•‡∏ö</button>
            </div>
          </div>
        </div>
        <ng-template #noCategories>
          <div class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
        </ng-template>
      </div>

      <div class="panel admin-card">
        <div class="panel-header">
          <div>
            <p class="eyebrow">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô</p>
            <h3 style="margin:4px 0">‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
          </div>
          <div class="pill-row">
            <span class="pill">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ {{ ps.products().length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
            <span class="pill pill-ghost">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>
          </div>
        </div>
        <div class="admin-toolbar">
          <button class="btn" (click)="logout()">Logout</button>
          <button class="btn danger" (click)="reset()">Reset ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</button>
          <button class="btn" (click)="exportCsv()">Export ‡πÄ‡∏õ‡πá‡∏ô Excel/CSV</button>
          <button class="btn success" type="button" (click)="applyChanges()" [disabled]="applying()">Apply</button>
          <label class="btn ghost file-btn">
            <span *ngIf="!importing()">Import Excel/CSV</span>
            <span *ngIf="importing()">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤...</span>
            <input type="file" accept=".csv,text/csv" (change)="importCsv($event)" [disabled]="importing()">
          </label>
          <button class="btn danger ghost" (click)="clearAllProducts()">‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>
        <p class="small muted">* ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Excel) ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå</p>

        <div class="form-grid two-col">
          <div><label class="small">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input class="input" [(ngModel)]="draft.name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏∏‡πâ‡∏á‡∏™‡∏î 1 ‡∏Å‡∏Å."></div>
          <div><label class="small">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label><input class="input" type="number" [(ngModel)]="draft.price" placeholder="0"></div>
          <div><label class="small">‡∏´‡∏ô‡πà‡∏ß‡∏¢</label><input class="input" [(ngModel)]="draft.unit" placeholder="‡πÅ‡∏û‡πá‡∏Ñ / ‡∏Å‡∏Å. / ‡∏ä‡∏¥‡πâ‡∏ô"></div>
          <div>
            <label class="small">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
            <input class="input" [(ngModel)]="draft.category" placeholder="‡∏Å‡∏∏‡πâ‡∏á / ‡∏õ‡∏•‡∏≤ / ‡∏ã‡∏≠‡∏™" list="category-options">
            <datalist id="category-options">
              <option *ngFor="let c of ps.categories()" [value]="c"></option>
            </datalist>
          </div>
          <div><label class="small">SKU</label><input class="input" [(ngModel)]="draft.sku" placeholder="‡πÉ‡∏™‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á"></div>
          <div class="full-row"><label class="small">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label><textarea class="input" rows="3" [(ngModel)]="draft.description" placeholder="‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ"></textarea></div>
          <div class="full-row upload-row">
            <div>
              <label class="small">‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå)</label>
              <input type="file" accept="image/*" multiple (change)="onUploadNew($event)">
              <p class="small muted" style="margin-top:4px">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô Data URL ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÑ‡∏°‡πà‡∏û‡∏∂‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å ‚Ä¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô</p>
            </div>
            <div class="image-chip" *ngIf="draft.images?.length">{{ draft.images.length }} ‡∏£‡∏π‡∏õ</div>
          </div>
        </div>
        <div *ngIf="draft.images?.length" class="preview-grid">
          <div class="preview-tile" *ngFor="let img of draft.images; let i = index">
            <img class="preview" [src]="img" alt="">
            <button class="btn tiny" type="button" (click)="removeDraftImage(i)">‡∏•‡∏ö</button>
          </div>
        </div>
        <div class="action-row">
          <button class="btn primary" (click)="add()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
          <button class="btn" (click)="clearDraft()">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
        </div>
      </div>

      <div class="panel admin-card">
        <div class="panel-header">
          <div>
            <p class="eyebrow">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
            <h3 style="margin:4px 0">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</h3>
          </div>
          <div class="pill pill-ghost">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÄ‡∏ã‡∏ü‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</div>
        </div>
        <div class="table-wrap admin-table-wrap">
          <table class="table admin-table">
            <thead><tr><th style="width:104px">‡∏£‡∏π‡∏õ</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th style="width:64px">‡∏£‡∏≤‡∏Ñ‡∏≤</th><th style="width:138px">‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏´‡∏°‡∏ß‡∏î</th><th style="width:68px">SKU</th><th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th><th style="width:170px">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
            <tbody>
              <tr *ngFor="let p of ps.products(); trackBy: track">
                <td class="cell image-cell" data-label="‡∏£‡∏π‡∏õ">
                  <div class="preview-frame preview-frame--row">
                    <img class="preview" [src]="p.image" alt="">
                  </div>
                  <div class="small muted" *ngIf="p.images?.length && p.images.length > 1">{{ p.images.length }} ‡∏£‡∏π‡∏õ</div>
                </td>
                <td class="cell" data-label="‡∏ä‡∏∑‡πà‡∏≠"><textarea class="input" rows="3" [(ngModel)]="p.name"></textarea></td>
                <td class="cell price-cell"  data-label="‡∏£‡∏≤‡∏Ñ‡∏≤"><input class="input" type="number" [(ngModel)]="p.price"></td>
                <td class="cell stack-cell" data-label="‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏´‡∏°‡∏ß‡∏î">
                  <div class="stack-cell__inputs">
                    <input class="input" [(ngModel)]="p.unit">
                    <input class="input" [(ngModel)]="p.category" list="category-options">
                  </div>
                </td>
                <td class="cell sku-cell" data-label="SKU"><input class="input" [(ngModel)]="p.sku"></td>
                <td class="cell" data-label="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"><textarea class="input" rows="3" [(ngModel)]="p.description"></textarea></td>
                <td class="cell tr-actions admin-row-actions" data-label="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£">
                  <div class="action-grid">
                    <label class="pill-btn ghost" title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ" aria-label="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ">
                      <span class="glyph" aria-hidden="true">üìÅ</span>
                      <span class="label">‡∏£‡∏π‡∏õ</span>
                      <input type="file" accept="image/*" (change)="onReplaceImage(p, $event)">
                    </label>
                    <label class="pill-btn ghost" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ">
                      <span class="glyph" aria-hidden="true">‚ûï</span>
                      <span class="label">‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                      <input type="file" accept="image/*" multiple (change)="onAddImages(p, $event)">
                    </label>
                    <button class="pill-btn success" title="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" aria-label="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" (click)="save(p)">
                      <span class="glyph" aria-hidden="true">üíæ</span>
                      <span class="label">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
                    </button>
                    <button class="pill-btn ghost" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" aria-label="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" (click)="cancelEdits()">
                      <span class="glyph" aria-hidden="true">‚Ü©</span>
                      <span class="label">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
                    </button>
                    <button class="pill-btn danger" title="‡∏•‡∏ö" aria-label="‡∏•‡∏ö" (click)="remove(p.id)">
                      <span class="glyph" aria-hidden="true">üóë</span>
                      <span class="label">‡∏•‡∏ö</span>
                    </button>
                  </div>
                  <div class="action-subtext">‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏î‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡πÄ‡∏ö‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
